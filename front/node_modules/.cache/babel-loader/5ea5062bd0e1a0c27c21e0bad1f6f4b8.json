{"ast":null,"code":"var _jsxFileName = \"/home/ethanh/Desktop/socket-squares-project/v1/src/components/SquaresPage.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport Square from './Square';\nimport { useState, useRef } from 'react';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faMagnifyingGlassPlus, faMagnifyingGlassMinus } from '@fortawesome/free-solid-svg-icons';\nimport { io, Socket } from \"socket.io-client\";\nimport \"./css/Squares.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst HEIGHT_IN_SQUARES = 11;\nconst MAX_PIXEL_WIDTH = 600; //of each square\n\nconst MIN_PIXEL_WIDTH = 200;\nlet socket;\n\nconst SquaresPage = () => {\n  _s();\n\n  const imgStates = new Array(HEIGHT_IN_SQUARES ** 2);\n  const [pixelWidth, setPixelWidth] = useState(500);\n  const scrollRef = useRef(); //reference to entire window of squares\n\n  const [isDown, setIsDown] = useState(false);\n  const [startX, setStartX] = useState(0);\n  const [startY, setStartY] = useState(0);\n  const [scrollLeft, setScrollLeft] = useState(0);\n  const [scrollTop, setScrollTop] = useState(0);\n  const [images, setImages] = useState(new Array(HEIGHT_IN_SQUARES ** 2));\n  const [isLoading, setIsLoading] = useState(false);\n  const [isConnectionError, stetIsConnectionError] = useState(false); //TODO: set so array of states instead of state of entire array?\n\n  const onMouseDown = e => {\n    setIsDown(true);\n    const slider = scrollRef.current;\n    slider.classList.add(\"active\");\n    setStartX(e.pageX - slider.offsetLeft);\n    setStartY(e.pageY - slider.offsetTop);\n    setScrollLeft(slider.scrollLeft);\n    setScrollTop(slider.scrollTop);\n  };\n\n  const onMouseUp = () => {\n    setIsDown(false);\n    scrollRef.current.classList.remove(\"active\");\n  };\n\n  const onMouseMove = e => {\n    e.preventDefault();\n    if (!isDown) return;\n    const slider = scrollRef.current;\n    const x = e.pageX - slider.offsetLeft;\n    const y = e.pageY - slider.offsetTop;\n    const walkx = Math.floor(1.1 * (x - startX));\n    const walky = Math.floor(1.1 * (y - startY));\n    slider.scrollLeft = scrollLeft - walkx;\n    slider.scrollTop = scrollTop - walky;\n  };\n\n  const onMouseLeave = () => {\n    setIsDown(false);\n    scrollRef.current.classList.remove(\"active\");\n  }; //TODO: smart zoom, so that when user zooms the squares' relative positions is same on screen (so square that was centred before is now centred again)\n\n\n  const zoomIn = () => {\n    if (pixelWidth < MAX_PIXEL_WIDTH) {\n      setPixelWidth(pixelWidth + 100);\n    }\n  };\n\n  const zoomOut = () => {\n    if (pixelWidth > MIN_PIXEL_WIDTH) {\n      setPixelWidth(pixelWidth - 100);\n    }\n  }; //on mount, set scroll so centred on centre square\n\n\n  useEffect(() => {\n    socket = io('http://localhost:3500');\n    socket.on('connect_error', () => {\n      stetIsConnectionError(true);\n    });\n    socket.on('connect', () => {\n      stetIsConnectionError(false);\n      const slider = scrollRef.current;\n      slider.scrollLeft = (pixelWidth * HEIGHT_IN_SQUARES - slider.clientWidth) / 2;\n      slider.scrollTop = (pixelWidth * HEIGHT_IN_SQUARES - slider.clientHeight) / 2;\n      socket.emit(\"get-all-images\", setAllImages);\n      /*\n      setInterval(()=>{\n      socket.emit(\"get-all-images\",setAllImages)\n      },1000)\n      */\n      //socket.on(\"setImage\", (index,image) => {}); //set individual image\n    });\n    socket.on('update-image', (index, img64) => {\n      const newArr = images.map((val, i) => {\n        if (i === index) return img64;else return val;\n      });\n      setImages(...(prev => prev.map((val, i) => {\n        if (i === index) return img64;else return val;\n      })));\n    });\n    return () => {\n      socket.disconnect();\n    };\n  }, []);\n\n  const setAllImages = array => {\n    console.log(array);\n    setImages(array);\n  };\n\n  return isConnectionError ? /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Connection Error\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 7\n  }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"zoom\",\n      id: \"zoom-plus\",\n      onClick: zoomIn,\n      children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faMagnifyingGlassPlus\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"zoom\",\n      id: \"zoom-minus\",\n      onClick: zoomOut,\n      children: /*#__PURE__*/_jsxDEV(FontAwesomeIcon, {\n        icon: faMagnifyingGlassMinus\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"squares-container\",\n      style: {\n        gridTemplateRows: `repeat(${HEIGHT_IN_SQUARES}, ${pixelWidth}px)`,\n        gridTemplateColumns: `repeat(${HEIGHT_IN_SQUARES}, ${pixelWidth}px)`\n      },\n      ref: scrollRef,\n      onMouseDown: onMouseDown,\n      onMouseUp: onMouseUp,\n      onMouseMove: onMouseMove,\n      onMouseLeave: onMouseLeave,\n      children: images.map((e, i) => /*#__PURE__*/_jsxDEV(Square, {\n        text: e,\n        index: i,\n        socket: socket\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 31\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(SquaresPage, \"VRqLJWzPbrrDBfJoa5PIJohZfcs=\");\n\n_c = SquaresPage;\nexport default SquaresPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"SquaresPage\");","map":{"version":3,"names":["React","useEffect","Square","useState","useRef","FontAwesomeIcon","faMagnifyingGlassPlus","faMagnifyingGlassMinus","io","Socket","HEIGHT_IN_SQUARES","MAX_PIXEL_WIDTH","MIN_PIXEL_WIDTH","socket","SquaresPage","imgStates","Array","pixelWidth","setPixelWidth","scrollRef","isDown","setIsDown","startX","setStartX","startY","setStartY","scrollLeft","setScrollLeft","scrollTop","setScrollTop","images","setImages","isLoading","setIsLoading","isConnectionError","stetIsConnectionError","onMouseDown","e","slider","current","classList","add","pageX","offsetLeft","pageY","offsetTop","onMouseUp","remove","onMouseMove","preventDefault","x","y","walkx","Math","floor","walky","onMouseLeave","zoomIn","zoomOut","on","clientWidth","clientHeight","emit","setAllImages","index","img64","newArr","map","val","i","prev","disconnect","array","console","log","gridTemplateRows","gridTemplateColumns"],"sources":["/home/ethanh/Desktop/socket-squares-project/v1/src/components/SquaresPage.js"],"sourcesContent":["import React, { useEffect } from 'react'\nimport Square from './Square'\nimport { useState, useRef } from 'react';\nimport {FontAwesomeIcon} from \"@fortawesome/react-fontawesome\"\nimport { faMagnifyingGlassPlus, faMagnifyingGlassMinus } from '@fortawesome/free-solid-svg-icons';\n\nimport {io, Socket} from \"socket.io-client\"\n\nimport \"./css/Squares.css\"\n\nconst HEIGHT_IN_SQUARES = 11;\nconst MAX_PIXEL_WIDTH = 600; //of each square\nconst MIN_PIXEL_WIDTH = 200;\n\nlet socket;\n\nconst SquaresPage = () => {\n\n  const imgStates = new Array(HEIGHT_IN_SQUARES**2);\n\n  const [pixelWidth, setPixelWidth] = useState(500);\n  const scrollRef = useRef(); //reference to entire window of squares\n\n  const [isDown, setIsDown] = useState(false);\n  const [startX, setStartX] = useState(0);\n  const [startY, setStartY] = useState(0);\n  const [scrollLeft, setScrollLeft] = useState(0);\n  const [scrollTop, setScrollTop] = useState(0); \n  const [images, setImages] = useState(new Array(HEIGHT_IN_SQUARES**2))\n  const [isLoading, setIsLoading] = useState(false);\n  const [isConnectionError, stetIsConnectionError] = useState(false);\n\n  //TODO: set so array of states instead of state of entire array?\n\n  const onMouseDown = e =>{\n      setIsDown(true);\n      const slider = scrollRef.current\n      slider.classList.add(\"active\");\n\n      setStartX(e.pageX - slider.offsetLeft);\n      setStartY(e.pageY - slider.offsetTop);\n\n      setScrollLeft(slider.scrollLeft);\n      setScrollTop(slider.scrollTop);\n      \n  };\n\n  const onMouseUp = () =>{\n    setIsDown(false);\n    scrollRef.current.classList.remove(\"active\");\n\n  };\n\n  const onMouseMove = e =>{\n      e.preventDefault();\n      if(!isDown) return;\n      const slider = scrollRef.current\n      const x = e.pageX - slider.offsetLeft;\n      const y = e.pageY - slider.offsetTop;\n\n      const walkx = Math.floor(1.1*(x-startX));\n      const walky = Math.floor(1.1*(y-startY));\n\n      slider.scrollLeft = scrollLeft-walkx;\n      slider.scrollTop = scrollTop - walky;\n  }\n\n  const onMouseLeave= () => {\n    setIsDown(false);\n    scrollRef.current.classList.remove(\"active\");\n  }\n\n  //TODO: smart zoom, so that when user zooms the squares' relative positions is same on screen (so square that was centred before is now centred again)\n  const zoomIn = ()=>{\n    if(pixelWidth<MAX_PIXEL_WIDTH){\n      setPixelWidth(pixelWidth + 100);\n    }\n  }\n\n  const zoomOut = ()=>{\n    if(pixelWidth>MIN_PIXEL_WIDTH){\n      setPixelWidth(pixelWidth - 100);\n    }\n  }\n\n  //on mount, set scroll so centred on centre square\n  useEffect(()=>{\n      \n    socket = io('http://localhost:3500')\n    \n    socket.on('connect_error', ()=>{\n      stetIsConnectionError(true)\n    })\n    \n    socket.on('connect', ()=>{\n      \n      stetIsConnectionError(false)\n      const slider = scrollRef.current;\n      slider.scrollLeft = (pixelWidth*HEIGHT_IN_SQUARES - slider.clientWidth)/2\n      slider.scrollTop = (pixelWidth*HEIGHT_IN_SQUARES - slider.clientHeight) / 2\n      \n      socket.emit(\"get-all-images\",setAllImages)\n\n      /*\n    setInterval(()=>{\n      socket.emit(\"get-all-images\",setAllImages)\n    },1000)\n    */\n      //socket.on(\"setImage\", (index,image) => {}); //set individual image\n\n      \n    })\n    \n    socket.on('update-image',(index,img64) =>{\n      const newArr = images.map((val,i) =>{\n        if(i===index) return img64;\n        else return val;\n      })\n\n      setImages(...prev => prev.map((val,i) =>{\n        if(i===index) return img64;\n        else return val;\n      }));\n    })\n\n    return () =>{\n      socket.disconnect();\n    }\n  },[])\n\n  const setAllImages = (array) =>{\n    console.log(array)\n    setImages(array);\n  }\n\n  \n  \n  return (\n    \n    isConnectionError\n    ? <p>Connection Error</p>\n    :\n\n    <>\n      <button className=\"zoom\" id=\"zoom-plus\" onClick={zoomIn}>\n        <FontAwesomeIcon icon={faMagnifyingGlassPlus} />\n      </button>\n\n      <button className=\"zoom\" id=\"zoom-minus\" onClick={zoomOut}>\n        <FontAwesomeIcon icon={faMagnifyingGlassMinus} />\n      </button>\n      \n      <div \n      id=\"squares-container\" \n      style= {{gridTemplateRows: `repeat(${HEIGHT_IN_SQUARES}, ${pixelWidth}px)`, \n              gridTemplateColumns: `repeat(${HEIGHT_IN_SQUARES}, ${pixelWidth}px)`}}\n      ref={scrollRef}\n      onMouseDown={onMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseMove={onMouseMove}\n      onMouseLeave={onMouseLeave}\n      >\n        {images.map((e, i) => <Square text={e} key={i} index={i} socket={socket}></Square>)}\n      </div>\n    </>\n  )\n}\n\nexport default SquaresPage"],"mappings":"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"},"metadata":{},"sourceType":"module"}